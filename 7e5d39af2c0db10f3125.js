import*as display from"./display.js";import*as list from"./list.js";import*as storage from"./storage.js";import*as todo from"./todo.js";import*as projects from"./projects.js";import{format,parse,startOfDay}from"date-fns";import"./styles.css";let order,sort,orderButton=document.querySelector("#order");orderButton.addEventListener("input",(()=>{console.log("working"),order=orderButton.value,console.log(order),list.orderList(order),display.renderList(list.sortList(sort))})),document.addEventListener("click",(t=>{if(t.target.classList.contains("toggle-info")){let e=t.target.closest(".todo");display.toggleInfo(e)}})),document.addEventListener("click",(t=>{t.target.classList.contains("sort")&&(sort=t.target.dataset.sort,display.renderCurrentSort(sort),display.renderList(list.sortList(sort)))}));const newTodoButton=document.querySelector(".new-todo"),dialog=document.querySelector("dialog");newTodoButton.addEventListener("click",(()=>{display.renderProjectsInput(projects.getProjects()),display.renderDateInput(dueInput),titleInput.style.outline="1px solid black",descriptionInput.style.outline="1px solid black",dialogHeader.textContent="New Todo",display.clearPriotiyInput(),document.querySelector("#blue").checked=!0,saveNewTodoButton.dataset.mode="new",saveNewTodoButton.dataset.id="none",dialog.showModal()}));const saveNewTodoButton=document.querySelector("dialog form button"),titleInput=document.querySelector("dialog form #title"),descriptionInput=document.querySelector("dialog form #description"),dueInput=document.querySelector("dialog form #due"),projectInput=document.querySelector("dialog #assign-project");saveNewTodoButton.addEventListener("click",(()=>{if(""!==titleInput.value.trim()&&""!==descriptionInput.value.trim()){const t=saveNewTodoButton.dataset.mode;if("new"==t){let t=titleInput.value,e=descriptionInput.value,o=document.querySelector('input[name="priority"]:checked').value,s=parse(dueInput.value,"yyyy-MM-dd",new Date),r=projectInput.value,i=todo.createTodo(t,e,o,s,r);list.addTodo(i),list.orderList(order),storage.saveList(list.getList()),dialog.close(),titleInput.value="",descriptionInput.value="",dueInput.value="",display.renderList(list.sortList(sort))}else if("edit"==t){let t=saveNewTodoButton.dataset.id,e=list.getTodoById(t),o=titleInput.value,s=descriptionInput.value,r=document.querySelector('input[name="priority"]:checked').value,i=parse(dueInput.value,"yyyy-MM-dd",new Date),d=projectInput.value,l=todo.createTodo(o,s,r,i,d);l.completion=e.completion,l.created=e.created,l.id=e.id,list.setTodoById(t,l),list.orderList(order),storage.saveList(list.getList()),dialog.close(),titleInput.value="",descriptionInput.value="",dueInput.value="",display.renderList(list.getList())}}else""==titleInput.value.trim()&&(console.log("title"),titleInput.style.outline="2px solid red"),""==descriptionInput.value.trim()&&(console.log("desc"),descriptionInput.style.outline="2px solid red")})),titleInput.addEventListener("input",(()=>{""!==titleInput.value.trim()&&(titleInput.style.outline="1px solid black")})),descriptionInput.addEventListener("input",(()=>{""!==descriptionInput.value.trim()&&(descriptionInput.style.outline="1px solid black")}));const newProjectButton=document.querySelector(".new-project"),projectDialog=document.querySelector(".project-dialog");newProjectButton.addEventListener("click",(()=>{projectNameInput.style.outline="1px solid black",projectDialog.showModal()}));const projectButton=document.querySelector(".project-button"),projectNameInput=document.querySelector("#project");projectButton.addEventListener("click",(()=>{if(""!==projectNameInput.value.trim()){let t=projectNameInput.value;projects.addProject(t),storage.saveProjects(projects.getProjects()),display.renderProjects(projects.getProjects()),projectDialog.close(),projectNameInput.value=""}else projectNameInput.style.outline="2px solid red"})),document.addEventListener("click",(t=>{if(t.target.classList.contains("delete")){let e=t.target.closest(".todo").dataset.id;list.removeTodoById(e),list.orderList(order),storage.saveList(list.getList()),display.renderList(list.sortList(sort))}})),document.addEventListener("click",(t=>{if("todo-completed"==t.target.id){let e=t.target.closest(".todo").dataset.id,o=list.getTodoById(e);o.toggle(),list.setTodoById(e,o),storage.saveList(list.getList("")),display.renderList(list.sortList(sort))}})),document.addEventListener("DOMContentLoaded",(()=>{dialog.open&&(console.log("working"),dialog.close());const t=storage.loadList(),e=storage.loadProjects();if(t&&t.length>0)list.setList(t);else{let t=todo.createTodo("Create your first todo","Click the button atop this page","red",startOfDay(new Date),"None"),e=todo.createTodo("Create a project","Projects are like folders for your todos, button is atop this page","yellow",startOfDay(new Date),"None"),o=todo.createTodo("Complete a todo","Once you have completed a task, check the circle to the left to mark it as completed!","blue",startOfDay(new Date),"None");list.addTodo(t),list.addTodo(e),list.addTodo(o),storage.saveList(list.getList())}e&&e.length>0&&projects.setProjects(e),list.orderList(order),console.log(list.getList()),display.renderList(list.sortList(sort)),display.renderProjects(projects.getProjects())})),document.addEventListener("keydown",(t=>{"Escape"===t.key&&(dialog.open&&(titleInput.value="",descriptionInput.value="",dueInput.value="",dialog.close()),projectDialog.open&&(projectNameInput.value="",projectDialog.close()))})),document.addEventListener("click",(t=>{t.target.classList.contains("close")&&(dialog.open&&(titleInput.value="",descriptionInput.value="",dueInput.value="",dialog.close()),projectDialog.open&&(projectNameInput.value="",projectDialog.close()))})),document.addEventListener("click",(t=>{if(t.target.classList.contains("project-delete")){let e=t.target.closest(".project").dataset.sort;projects.removeProject(e),storage.saveProjects(projects.getProjects()),display.renderProjects(projects.getProjects()),list.getList().forEach((t=>{t.project==e&&(t.project="None")})),storage.saveList(list.getList()),display.renderList(list.getList())}}));let dialogHeader=document.querySelector("dialog h2");document.addEventListener("click",(t=>{if(t.target.classList.contains("edit")){saveNewTodoButton.dataset.mode="edit";let e=t.target.closest(".todo").dataset.id;saveNewTodoButton.dataset.id=e;let o=list.getTodoById(e);dialogHeader.textContent="Edit Todo",titleInput.value=o.title,descriptionInput.value=o.description,display.renderProjectsInput(projects.getProjects()),projectInput.value=o.project,dueInput.value=format(o.due,"yyyy-MM-dd"),display.clearPriotiyInput(),document.querySelectorAll('input[type="radio"]').forEach((t=>{t.value==o.priority&&(t.checked=!0)})),dialog.showModal()}}));